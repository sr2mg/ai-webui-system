<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>GPT3.5 API Demo</title>
</head>

<body>
    <div>
        <label for="api-key">API Key:</label>
        <input type="text" id="api-key" name="apiKey">
    </div>
    <div>
        <label for="question">質問文:</label>
        <textarea id="question" name="message" rows="4" cols="50"></textarea>
    </div>
    <div>
        <button id="submit-btn">質問する！</button>
    </div>
    <div>
        <label for="answer">回答</label>
        <textarea id="answer" name="answer" rows="8" cols="50" readonly></textarea>
    </div>
    <p>
        使い方！API Keyを入力して質問文を入力して質問ボタンを押すと回答が返ってきます！API Keyは<a
            href="https://platform.openai.com/account/api-keys">OpenAI</a>にアクセスし、Create new secret keyから取得してください！
    </p>
    <script>
        const apiKeyInput = document.getElementById('api-key');
        const questionInput = document.getElementById('question');
        const answerOutput = document.getElementById('answer');
        const submitButton = document.getElementById('submit-btn');
        const API_ENDPOINT = 'http://localhost:3000';
        submitButton.addEventListener('click', async () => {
            const apiKey = apiKeyInput.value;
            const question = questionInput.value;
            const data = {
                apiKey: apiKey,
                message: question
            }
            // ここ直す
            const response = await fetch(API_ENDPOINT + '/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(data)
            });

            if (response.ok) {
                res = await response.json();
                console.log(res);
                answerOutput.value = await res.content;
            } else {
                answerOutput.value = 'Error: ' + response.statusText;
            }
        });
    </script>
</body>

</html>